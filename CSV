# Define the folder path containing the CSV files
$folderPath = "C:\path\to\your\csv\files"

# Define the output file path for the appended CSV
$outputFile = "C:\path\to\your\output\combined.csv"

# Get all CSV files in the folder
$csvFiles = Get-ChildItem -Path $folderPath -Filter *.csv

# Initialize a flag to track whether the header has been written to the output file
$headerWritten = $false

# Loop through each CSV file and append it to the output file
foreach ($file in $csvFiles) {
    # Import the CSV file
    $csvContent = Import-Csv -Path $file.FullName
    
    # If the header hasn't been written to the output file, modify and write it
    if (-not $headerWritten) {
        # Get the first row as the header
        $header = $csvContent[0].PSObject.Properties.Name
        
        # Replace spaces with underscores in the header
        $newHeader = $header -replace ' ', '_'
        
        # Update the header in the CSV content
        $csvContent = $csvContent | Select-Object $newHeader
        
        # Export the updated content with the modified header
        $csvContent | Export-Csv -Path $outputFile -NoTypeInformation
        $headerWritten = $true
    } else {
        # Append content without modifying the header
        $csvContent | Export-Csv -Path $outputFile -NoTypeInformation -Append
    }
}

Write-Host "CSV files have been appended successfully to $outputFile with headers modified."
